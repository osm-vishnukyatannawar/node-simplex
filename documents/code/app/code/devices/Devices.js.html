<!DOCTYPE html>
<html>
<head>
  <title>Devices.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../", thisFile = "app/code/devices/Devices.js", defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>
  <script src="../../../fileSearch.js"></script>
  <link rel="stylesheet" href="../../../fileSearch.css" />
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>Devices.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__CONFIG__</span><span class="p">.</span><span class="nx">app_base_path</span> <span class="o">+</span> <span class="s1">&#39;lib/model&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Authorization</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__CONFIG__</span><span class="p">.</span><span class="nx">app_code_path</span> <span class="o">+</span> <span class="s1">&#39;authorization/Authorization&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">__</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">AppError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__CONFIG__</span><span class="p">.</span><span class="nx">app_base_path</span> <span class="o">+</span> <span class="s1">&#39;lib/app-error&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">devicesProp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__CONFIG__</span><span class="p">.</span><span class="nx">app_code_path</span> <span class="o">+</span> <span class="s1">&#39;devices/DevicesProperties&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">Devices</span><span class="p">(</span><span class="nx">objToBind</span><span class="p">,</span> <span class="nx">requestParameters</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">properties</span><span class="p">,</span> <span class="nx">objToBind</span><span class="p">,</span> <span class="nx">requestParameters</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">util</span><span class="p">.</span><span class="nx">inherits</span><span class="p">(</span><span class="nx">Devices</span><span class="p">,</span> <span class="nx">Model</span><span class="p">);</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">properties</span> <span class="o">=</span> <span class="nx">devicesProp</span><span class="p">;</span>
<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">defaultSelectProps</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">sortBy</span><span class="o">:</span> <span class="s1">&#39;asc&#39;</span><span class="p">,</span>
  <span class="nx">sortCol</span><span class="o">:</span> <span class="s1">&#39;deviceId&#39;</span><span class="p">,</span>
  <span class="nx">limit</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nx">startRecord</span><span class="o">:</span> <span class="mi">0</span>
<span class="p">};</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDevicesByOrgId</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">organizationID</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getQueryForAllDevices</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getResults</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">isGrid</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">queryResult</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">__</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">queryResult</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s1">&#39;notFound&#39;</span><span class="p">),</span>
          <span class="s1">&#39;No users found with organization id - &#39;</span> <span class="o">+</span> <span class="nx">organizationID</span><span class="p">,</span> <span class="p">{});</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>sqlQuery = that.getUserSelectQuery(condition, false, true);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">getQueryForAllDevices</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="nx">that</span><span class="p">.</span><span class="nx">getResult</span><span class="p">({</span>
        <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
        <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
          <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>queryResult = processSelectResponse(queryResult);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="kd">var</span> <span class="nx">numOfRecords</span> <span class="o">=</span> <span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">numOfRecords</span> <span class="o">?</span> <span class="nx">data</span><span class="p">.</span><span class="nx">numOfRecords</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">finalResult</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">queryResult</span><span class="p">,</span>
            <span class="nx">numOfRecords</span><span class="o">:</span> <span class="nx">numOfRecords</span>
          <span class="p">};</span>
          <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">finalResult</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getQueryForAllDevices</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">isGridData</span><span class="p">,</span> <span class="nx">isCount</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">condition</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">condition</span> <span class="o">=</span> <span class="s1">&#39;COUNT(device_types.device_id) AS &quot;numOfRecords&quot; ,&#39;</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s1">&#39;SELECT&#39;</span> <span class="o">+</span> <span class="s1">&#39; device_types.device_id AS &quot;deviceId&quot;,&#39;</span> <span class="o">+</span> <span class="nx">condition</span> <span class="o">+</span>
    <span class="s1">&#39; device_type_id_enum    AS &quot;type&quot;,&#39;</span> <span class="o">+</span> <span class="s1">&#39; manufacturer_name      AS &quot;mfg&quot;,&#39;</span> <span class="o">+</span>
    <span class="s1">&#39; model_number           AS &quot;model&quot;,&#39;</span> <span class="o">+</span>
    <span class="s1">&#39; (SELECT lookup_value_vc    FROM tag_lookup_table   WHERE lookup_recid = tag_maint_call.tag_usage_info_id_enum)   AS &quot;deviceStatus&quot;,&#39;</span> <span class="o">+</span>
    <span class="s1">&#39; tag_util_percent.util_percent_6months   AS &quot;util&quot;,&#39;</span> <span class="o">+</span> <span class="s1">&#39; &quot;&quot;        AS &quot;dailyEnergy&quot;,&#39;</span> <span class="o">+</span>
    <span class="s1">&#39; tag_info.last_maintenance_date  AS &quot;lastSeen&quot;,&#39;</span> <span class="o">+</span> <span class="s1">&#39; &quot;&quot;                     AS  &quot;lastUsed&quot;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39; FROM device_types&#39;</span> <span class="o">+</span>
    <span class="s1">&#39; LEFT OUTER JOIN tag_info ON device_types.device_type_recid =tag_info.device_type_recid &#39;</span> <span class="o">+</span>
    <span class="s1">&#39; LEFT OUTER JOIN tag_maint_call ON tag_info.tag_info_recid = tag_maint_call.tag_info_recid &#39;</span> <span class="o">+</span>
    <span class="s1">&#39; LEFT OUTER JOIN tag_util_percent ON tag_maint_call.tag_util_percent_recid = tag_util_percent.tag_util_percent_recid &#39;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">isGridData</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">processGridQuery</span><span class="p">(</span><span class="nx">sqlQuery</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">sqlQuery</span> <span class="o">+=</span> <span class="s1">&#39;;&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">sqlQuery</span><span class="p">;</span>
<span class="p">}</span>


<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">insertTreshHoldValues</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">insertObj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">insertObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;transactionID&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">transactionID</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">transactionID</span><span class="p">;</span>
    <span class="nx">deviceObj</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO tag_current_thresh  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;( tag_current_thresh_recid, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; thresh_off, thresh_inactive,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; thresh_active, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;is_active, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;created_on, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;created_by ) VALUES ( &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;:tagCurrentThreshRecId, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;:threshOff,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :threshInactive,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :threshactive,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  1, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :createdOn,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :createdBy );&quot;</span><span class="p">;</span>
  <span class="nx">that</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">deviceObj</span><span class="p">,</span>
    <span class="nx">transactionID</span><span class="o">:</span> <span class="nx">transactionID</span><span class="p">,</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
          <span class="s2">&quot;There was a problem on the server.Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateTreshHoldValues</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">insertObj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">insertObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;transactionID&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">transactionID</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">transactionID</span><span class="p">;</span>
    <span class="nx">deviceObj</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;UPDATE  tag_current_thresh SET  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;thresh_off = IFNULL(:threshOff,thresh_off),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;thresh_inactive = IFNULL(:threshInactive,thresh_inactive),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;thresh_active = IFNULL(:threshActive, thresh_active) &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;WHERE tag_current_thresh_recid = :tagCurrentThreshRecId;&quot;</span>

  <span class="nx">that</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">deviceObj</span><span class="p">,</span>
    <span class="nx">transactionID</span><span class="o">:</span> <span class="nx">transactionID</span><span class="p">,</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
          <span class="s2">&quot;There was a problem on the server.Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">insertPimDetails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">insertObj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">transactionID</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">insertObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;transactionID&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">transactionID</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">transactionID</span><span class="p">;</span>
    <span class="nx">deviceObj</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO tag_pim_config  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;(  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;tag_pim_config_recid, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  pimconfig_enable, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; tag_pim_trig_type_id_enum, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; elapsed_time_10ms,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; iir_filter_mhz, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;rms_diff_thresh_ma, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;trig_delay_10ms ,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;samp_rate_hz , &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;meas_dur_10ms, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;is_active, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;created_on , &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;created_by )   &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;VALUES ( &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;:tagPimConfigRecId, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :pimConfigEnable, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :tagPimTrigTypeIdEnum,  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :elapsedTime_10ms,  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :iirFIlterMHz, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :rmsDiffThreshMa,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :trigDelay_10ms,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :sampRateHz,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :measDur_10ms,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;   1, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :createdOn,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :createdBy);&quot;</span><span class="p">;</span>
  <span class="nx">that</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">deviceObj</span><span class="p">,</span>
    <span class="nx">transactionID</span><span class="o">:</span> <span class="nx">transactionID</span><span class="p">,</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
          <span class="s2">&quot;There was a problem on the server.Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updatePimDetails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">insertObj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">transactionID</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">insertObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;transactionID&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">transactionID</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">transactionID</span><span class="p">;</span>
    <span class="nx">deviceObj</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;UPDATE  tag_pim_config SET  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; pimconfig_enable = IFNULL(:pimConfigEnable,pimconfig_enable),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; tag_pim_trig_type_id_enum = IFNULL(:tagPimTrigTypeIdEnum, elapsed_time_10ms),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; elapsed_time_10ms = IFNULL(:elapsedTime_10ms, elapsed_time_10ms),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; iir_filter_mhz = IFNULL(:iirFilterMHz, iir_filter_mhz),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; rms_diff_thresh_ma = IFNULL(:rmsDiffThreshMa, rms_diff_thresh_ma),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; trig_delay_10ms = IFNULL(:trigDelay_10ms, trig_delay_10ms),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; samp_rate_hz = IFNULL(:sampRateHz, samp_rate_hz),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; meas_dur_10ms = IFNULL(:measDur_10ms, meas_dur_10ms)&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; WHERE tag_pim_config_recid = :tagPimConfigRecId;&quot;</span><span class="p">;</span>

  <span class="nx">that</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">deviceObj</span><span class="p">,</span>
    <span class="nx">transactionID</span><span class="o">:</span> <span class="nx">transactionID</span><span class="p">,</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
          <span class="s2">&quot;There was a problem on the server.Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">insertDeviceTypes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">insertObj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">transactionID</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">insertObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;transactionID&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">transactionID</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">transactionID</span><span class="p">;</span>
    <span class="nx">deviceObj</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO device_types ( &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; device_type_recid, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; device_id,  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; device_type_id_enum,   &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; device_name,     &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; model_number,   &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; manufacturer_name,   &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; device_desc,  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; is_active,  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; created_on,  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; created_by, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; tag_current_thresh_recid,  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; tag_pim_config_recid     &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; )VALUES( &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  :deviceTypeRecId,  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  :deviceId, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  :deviceTypeIdEnum,  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  :deviceName, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  :modelNumber,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  :manufacturerName,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  :deviceDesc,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  1,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :createdOn,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :createdBy,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :tagCurrentThreshRecId, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;  :tagPimConfigRecId  );&quot;</span><span class="p">;</span>

  <span class="nx">that</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">deviceObj</span><span class="p">,</span>
    <span class="nx">transactionID</span><span class="o">:</span> <span class="nx">transactionID</span><span class="p">,</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
          <span class="s2">&quot;There was a problem on the server.Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateDeviceTypes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">insertObj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">transactionID</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">insertObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;transactionID&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">transactionID</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">transactionID</span><span class="p">;</span>
    <span class="nx">deviceObj</span> <span class="o">=</span> <span class="nx">insertObj</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;UPDATE device_types SET device_name = IFNULL(:deviceName,device_name),&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; device_desc = IFNULL(:deviceDesc,device_desc), &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; modified_on = :modifiedOn &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; WHERE device_type_recid = :device_type_recid;&quot;</span><span class="p">;</span>

  <span class="nx">that</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">deviceObj</span><span class="p">,</span>
    <span class="nx">transactionID</span><span class="o">:</span> <span class="nx">transactionID</span><span class="p">,</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
          <span class="s2">&quot;There was a problem on the server.Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getCalibrationDetails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">readCsvFile</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;Error while reading CSV&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;Error while reading CSV&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">));</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAllDevicesForCsv</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;SELECT &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;dev.device_type_id_enum deviceTypeIdEnum, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;dev.device_name deviceName, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;dev.model_number modelNumber, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;dev.manufacturer_name manufacturerName, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;dev.device_desc deviceDesc, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;cur.thresh_off threshOff, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;cur.thresh_inactive threshInactive,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;cur.thresh_active threshActive,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;pim.pimconfig_enable pimConfigEnable,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;pim.tag_pim_trig_type_id_enum tagPimTrigTypeIdEnum, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;pim.elapsed_time_10ms elapsedTime_10ms,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;pim.iir_filter_mhz iirFilterMHz,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;pim.rms_diff_thresh_ma rmsDiffThreshMa,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;pim.trig_delay_10ms trigDelay_10ms,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;pim.samp_rate_hz sampRateHz,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;pim.meas_dur_10ms measDur_10ms &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;FROM device_types dev &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;LEFT JOIN tag_current_thresh cur ON dev.tag_current_thresh_recid = cur.tag_current_thresh_recid &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;LEFT JOIN tag_pim_config pim ON dev.tag_pim_config_recid = pim.tag_pim_config_recid &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;WHERE dev.is_active = ? AND cur.is_active = ? AND pim.is_active = ?&quot;</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">getResults</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="nx">isActive</span><span class="p">,</span> <span class="nx">isActive</span><span class="p">,</span> <span class="nx">isActive</span><span class="p">],</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s1">&#39;badRequest&#39;</span><span class="p">),</span>
          <span class="s1">&#39;There was an error on the server. Please try again&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">__</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s1">&#39;notFound&#39;</span><span class="p">),</span>
          <span class="s1">&#39;There are no devices to export&#39;</span><span class="p">,</span> <span class="p">{}));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>




<span class="p">};</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getCountAndModifiyDate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;SELECT  device_types.modified_on modifiedOn,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; user_m.email_id userEmail, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; (SELECT COUNT(*) FROM dev_emanate_db.device_types WHERE device_types.is_active = 1) devicesCount &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; FROM dev_emanate_db.device_types INNER JOIN user_m ON device_types.created_by = user_m.user_recid &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; WHERE device_types.is_active = ? ORDER BY device_types.modified_on DESC LIMIT 1;&quot;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getResult</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="nx">isActive</span><span class="p">],</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s1">&#39;badRequest&#39;</span><span class="p">),</span>
          <span class="s1">&#39;There was an error on the server. Please try again&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">__</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s1">&#39;notFound&#39;</span><span class="p">),</span>
          <span class="s1">&#39;There are no devices to export&#39;</span><span class="p">,</span> <span class="p">{}));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="p">};</span>

<span class="nx">Devices</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkIfRecordExist</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">deviceData</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;SELECT tag_current_thresh_recid tagCurrentThreshRecId , &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; tag_pim_config_recid tagPimConfigRecId , &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; device_type_recid deviceTypeRecId   &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; FROM device_types WHERE device_id = ?&quot;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getResult</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="nx">deviceData</span><span class="p">.</span><span class="nx">deviceId</span><span class="p">],</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s1">&#39;badRequest&#39;</span><span class="p">),</span>
          <span class="s1">&#39;There was an error on the server. Please try again&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>

    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Devices</span><span class="p">;</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
