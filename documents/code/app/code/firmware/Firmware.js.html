<!DOCTYPE html>
<html>
<head>
  <title>Firmware.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../", thisFile = "app/code/firmware/Firmware.js", defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>
  <script src="../../../fileSearch.js"></script>
  <link rel="stylesheet" href="../../../fileSearch.css" />
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h2">
        <a href="#get%20firmware%20versions%20which%20are%20active.">Get firmware versions which are active.</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>Firmware.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<p>Custom Models</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__CONFIG__</span><span class="p">.</span><span class="nx">app_base_path</span> <span class="o">+</span> <span class="s1">&#39;lib/model&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__CONFIG__</span><span class="p">.</span><span class="nx">app_base_path</span> <span class="o">+</span> <span class="s1">&#39;logger&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-uuid&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;async&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">__</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">AppError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__CONFIG__</span><span class="p">.</span><span class="nx">app_base_path</span> <span class="o">+</span> <span class="s1">&#39;lib/app-error&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">Firmware</span><span class="p">(</span><span class="nx">objToBind</span><span class="p">,</span> <span class="nx">requestParameters</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">properties</span><span class="p">,</span> <span class="nx">objToBind</span><span class="p">,</span> <span class="nx">requestParameters</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">util</span><span class="p">.</span><span class="nx">inherits</span><span class="p">(</span><span class="nx">Firmware</span><span class="p">,</span> <span class="nx">Model</span><span class="p">);</span>


<span class="nx">Firmware</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkForOverallVersionInDb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">version</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(*) as fvCount FROM firmware_versions WHERE overall_version = ?;&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getResults</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="nx">version</span><span class="p">],</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">queryResult</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">queryResult</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;fvCount&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;badRequest&quot;</span><span class="p">),</span>
          <span class="s2">&quot;This version number already exist. Enter a unique version&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">queryResult</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="nx">Firmware</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">insertFirmwareDets</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">detailsObj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span>
    <span class="s2">&quot;INSERT INTO firmware_versions (`firmware_version_recid`,`overall_version` , `change_log` , `host_fw_version` ,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; `wifi_fw_version` , `ble_fw_version` , `created_on` , `created_by` , `host_fw_image_path`,`wifi_fw_image_path`,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; `ble_fw_image_path` ) &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;VALUES(:fwReccid , :overallVersion, :changeLog , &quot;</span> <span class="o">+</span>
    <span class="s2">&quot;:hostVersion ,:wifiversion,:bleVersion ,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; :createdOn , :createdBy , :hostPath ,:wifiPath ,:blePath )&quot;</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">getObjectForInsertFirmware</span><span class="p">(</span><span class="nx">detailsObj</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">fwDetails</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
        <span class="s2">&quot;There was a problem on the server.Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="nx">that</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
      <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">fwDetails</span><span class="p">,</span>
      <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
            <span class="s2">&quot;There was a problem on the server.Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="nx">Firmware</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getObjectForInsertFirmware</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">detailsObj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">propArray</span> <span class="o">=</span> <span class="nx">detailsObj</span><span class="p">[</span><span class="s1">&#39;propArray&#39;</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">clientObj</span> <span class="o">=</span> <span class="nx">detailsObj</span><span class="p">[</span><span class="s1">&#39;clientObj&#39;</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">baseFirmwareFileStrs</span> <span class="o">=</span> <span class="nx">global</span><span class="p">.</span><span class="nx">__CONFIG__</span><span class="p">.</span><span class="nx">firmware</span><span class="p">.</span><span class="nx">baseFirmwareFileStrs</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">defaultObj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getDefaultFirmwareObj</span><span class="p">();</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>TODO :: Trim this data.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">fwObj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fwReccid&#39;</span><span class="o">:</span> <span class="nx">defaultObj</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="s1">&#39;overallVersion&#39;</span><span class="o">:</span> <span class="nx">clientObj</span><span class="p">.</span><span class="nx">version</span><span class="p">,</span>
    <span class="s1">&#39;changeLog&#39;</span><span class="o">:</span> <span class="nx">clientObj</span><span class="p">.</span><span class="nx">changeLog</span><span class="p">,</span>
    <span class="s1">&#39;hostVersion&#39;</span><span class="o">:</span> <span class="nx">propArray</span><span class="p">[</span><span class="nx">baseFirmwareFileStrs</span><span class="p">.</span><span class="nx">host_fw_version</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">],</span>
    <span class="s1">&#39;hostPath&#39;</span><span class="o">:</span> <span class="nx">propArray</span><span class="p">[</span><span class="nx">baseFirmwareFileStrs</span><span class="p">.</span><span class="nx">host_fw_version</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">],</span>
    <span class="s1">&#39;wifiversion&#39;</span><span class="o">:</span> <span class="nx">propArray</span><span class="p">[</span><span class="nx">baseFirmwareFileStrs</span><span class="p">.</span><span class="nx">wifi_fw_version</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">],</span>
    <span class="s1">&#39;wifiPath&#39;</span><span class="o">:</span> <span class="nx">propArray</span><span class="p">[</span><span class="nx">baseFirmwareFileStrs</span><span class="p">.</span><span class="nx">wifi_fw_version</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">],</span>
    <span class="s1">&#39;bleVersion&#39;</span><span class="o">:</span> <span class="nx">propArray</span><span class="p">[</span><span class="nx">baseFirmwareFileStrs</span><span class="p">.</span><span class="nx">ble_fw_version</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">],</span>
    <span class="s1">&#39;blePath&#39;</span><span class="o">:</span> <span class="nx">propArray</span><span class="p">[</span><span class="nx">baseFirmwareFileStrs</span><span class="p">.</span><span class="nx">ble_fw_version</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">],</span>
    <span class="s1">&#39;createdOn&#39;</span><span class="o">:</span> <span class="nx">defaultObj</span><span class="p">.</span><span class="nx">createdOn</span><span class="p">,</span>
    <span class="s1">&#39;createdBy&#39;</span><span class="o">:</span> <span class="nx">clientObj</span><span class="p">.</span><span class="nx">userId</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">fwObj</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">Firmware</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getLatestFirmware</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM firmware_versions WHERE is_active = ? ORDER BY created_on DESC limit 1&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getResult</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="nx">isActive</span><span class="p">],</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">queryResult</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">__</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">queryResult</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;badRequest&quot;</span><span class="p">),</span>
          <span class="s2">&quot;Sorry we couldn&#39;t find any previous firmware versions. Your uploaded zip should contain all the firmwares.&quot;</span><span class="p">,</span> <span class="p">{}</span>
        <span class="p">));</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
          <span class="s2">&quot;There was a problem on the server. Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">queryResult</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="nx">Firmware</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDefaultFirmwareObj</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">currDate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dbUtils</span><span class="p">.</span><span class="nx">toMySQLDateTime</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">v4</span><span class="p">(),</span>
    <span class="nx">token</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">createdOn</span><span class="o">:</span> <span class="nx">currDate</span><span class="p">,</span>
    <span class="nx">isValid</span><span class="o">:</span> <span class="mi">1</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="nx">Firmware</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAllFirmwareDetsFormDb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;SELECT &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; m.host_fw_version AS hostVersion , &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; m.wifi_fw_version AS wifiVersion , &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; m.ble_fw_version AS bleVersion , &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; m.created_on AS createdOn , &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; m.overall_version AS overAllVersion, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; m.host_fw_image_path AS hostPath, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; m.wifi_fw_image_path AS wifiPath, &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; m.ble_fw_image_path AS blePath,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; s.user_name  AS uploadedBy  &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; FROM firmware_versions as m , user_m as s WHERE m.is_active = ? and m.created_by = s.user_recid &quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getResults</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="nx">isActive</span><span class="p">],</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">queryResult</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">__</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">queryResult</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
       
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
          <span class="s2">&quot;There was a problem on the server. Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">queryResult</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="nx">Firmware</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAllDevicesFromDb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="get%20firmware%20versions%20which%20are%20active.">
  <h2>
    <a href="#get%20firmware%20versions%20which%20are%20active." name="get%20firmware%20versions%20which%20are%20active." class="pilcrow">&#182;</a>
    Get firmware versions which are active.
  </h2>
</div>

  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span>{object} Callback method</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="nx">Firmware</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFirwareVersions</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sqlQuery</span> <span class="o">=</span> <span class="s2">&quot;SELECT &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; firmware_version_recid AS firmwareID ,&quot;</span> <span class="o">+</span>
    <span class="s2">&quot; CONCAT(overall_version, &#39;  ( &#39;,wifi_fw_version,&#39; - &#39;,ble_fw_version,&#39; - &#39;,host_fw_version,&#39; )&#39;) AS overAllVersion &quot;</span> <span class="o">+</span>
    <span class="s2">&quot; FROM firmware_versions WHERE is_active = ?&quot;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getResults</span><span class="p">({</span>
    <span class="nx">query</span><span class="o">:</span> <span class="nx">sqlQuery</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">getActiveID</span><span class="p">()],</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">queryResult</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">__</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">queryResult</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nx">AppError</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">getStatusCode</span><span class="p">(</span><span class="s2">&quot;internalError&quot;</span><span class="p">),</span>
          <span class="s2">&quot;There was a problem on the server. Please try again later&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">queryResult</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Firmware</span><span class="p">;</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
